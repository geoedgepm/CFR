{% load static %}
<!DOCTYPE html>
<html lang="en" ng-app="mapApp">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>CFR</title>

    <!-- Bootstrap -->
    <link href="{% static 'dashboard/vendors/bootstrap/dist/css/bootstrap.min.css' %} " rel="stylesheet">

    <!-- Font Awesome -->
    <link href="{% static 'dashboard/vendors/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">
    <!-- NProgress -->
    <link href="{% static 'dashboard/vendors/nprogress/nprogress.css' %}" rel="stylesheet">
    <!-- iCheck -->
    <link href="{% static 'dashboard/vendors/iCheck/skins/flat/green.css' %}" rel="stylesheet">
    <!-- bootstrap-progressbar -->
    <link href="{% static 'dashboard/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css' %}"
          rel="stylesheet">
    <!-- JQVMap -->

    <link href="{% static 'dashboard/vendors/openlayers/ol.css' %}" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="{% static 'dashboard/css/custom.css' %}" rel="stylesheet">

    <script src="{% static 'dashboard/vendors/jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'dashboard/vendors/openlayers/ol.js' %}"></script>
    <script src="{% static 'reports/js/angular/angular.js' %}"></script>
    <script src="{% static 'reports/js/angular/angular-resource.js' %}"></script>
    <script src="{% static 'reports/js/angular-cookies/angular-cookies.min.js' %}"></script>

    <!--script src="{% static 'dashboard/js/dashboard.js' %}"></script-->
    <script src="{% static 'maps/js/map.js' %}"></script>

    <script src="{% static 'charts/js/d3.min.js ' %}"></script>
    <script src="{% static 'charts/js/nv.d3.min.js' %}"></script>
    <script src="{% static 'charts/js/angular-nvd3/dist/angular-nvd3.js' %}"></script>


</head>

<body class="nav-md" ng-controller="DashboardController" ng-init="init()">
<div class="container body">
    <div class="main_container">
        <div class="col-md-3 left_col">
            <div class="left_col scroll-view">
                <div class="navbar nav_title" style="border: 0;">
                    <a href="index.html" class="site_title"><i class="fa fa-map-marker"></i> <span>CFR</span></a>
                </div>

                <div class="clearfix"></div>

                <!-- menu profile quick info -->
                <div class="profile">
                    <div class="profile_pic">
                        <img src="images/img.png" alt="..." class="img-circle profile_img">
                    </div>
                    <div class="profile_info">
                        <span>Welcome,</span>
                        <h2>Admin</h2>
                    </div>
                </div>
                <!-- /menu profile quick info -->

                <br/>

                <!-- sidebar menu -->
                <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                    <div class="menu_section">
                        <h3 style="color:#898989;">----------------------------------------</h3>
                        <ul class="nav side-menu">
                            <li><a href="index.html"><i class="fa fa-home"></i> Dashboard </a>

                            </li>
                            <li><a href="map.html"><i class="fa fa-edit"></i> Disaster Map </a>

                            </li>
                            <li><a><i class="fa fa-desktop"></i> User Manegment <span class="fa fa-chevron-down"></span></a>
                                <ul class="nav child_menu">
                                    <li><a href="add_user.html">Add User</a></li>
                                    <li><a href="profile.html">Profile</a></li>
                                    <li><a href="user_maneger.html">Manage Users</a></li>

                                </ul>
                            </li>
                            <!--li><a href="add_disaster.html"><i class="fa fa-table"></i> Add Disaster </a-->

                            </li>
                            <li><a href="incedent.html"><i class="fa fa-table"></i> Incedents </a>

                            </li>
                            <li><a href="charts.html"><i class="fa fa-table"></i> Charts </a>

                            </li>


                        </ul>
                    </div>


                </div>
                <!-- /sidebar menu -->


            </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
            <div class="nav_menu">
                <nav>
                    <div class="nav toggle">
                        <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                    </div>

                    <ul class="nav navbar-nav navbar-right">
                        <li class="">
                            <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown"
                               aria-expanded="false">
                                <img src="images/img.png" alt="">Admin
                                <span class=" fa fa-angle-down"></span>
                            </a>
                            <ul class="dropdown-menu dropdown-usermenu pull-right">
                                <li><a href="javascript:;"> Profile</a></li>

                                <li><a href="javascript:;">Help</a></li>
                                <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                            </ul>
                        </li>

                        <li role="presentation" class="dropdown">
                            <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown"
                               aria-expanded="false">
                                <i class="fa fa-envelope-o"></i>
                                <span class="badge bg-green">6</span>
                            </a>
                            <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                                <li>
                                    <a>
                                        <span class="image"><img src="images/img.png" alt="Profile Image"/></span>
                        <span>
                          <span>Admin User</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a>
                                        <span class="image"><img src="images/img.png" alt="Profile Image"/></span>
                        <span>
                          <span>Admin User</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a>
                                        <span class="image"><img src="images/img.png" alt="Profile Image"/></span>
                        <span>
                          <span>Admin User</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a>
                                        <span class="image"><img src="images/img.png" alt="Profile Image"/></span>
                        <span>
                          <span>Admin User</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                        </span>
                                    </a>
                                </li>
                                <li>
                                    <div class="text-center">
                                        <a>
                                            <strong>See All Messages</strong>
                                            <i class="fa fa-angle-right"></i>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
            <!-- top tiles -->
            <div class="row tile_count">
                <div class="col-md-3 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> New Incedents</span>
                    <div class="count red">25</div>

                </div>
                <div class="col-md-3 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-clock-o"></i> Unconfirmed</span>
                    <div class="count blue" ng-bind="non_confirmed"></div>

                </div>
                <div class="col-md-3 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> Confirmed</span>
                    <div class="count green" ng-bind="confirmed"></div>

                </div>
                <div class="col-md-3 col-sm-4 col-xs-6 tile_stats_count">
                    <span class="count_top"><i class="fa fa-user"></i> Total Incedents</span>
                    <div class="count purple" ng-bind="total_incidents"></div>

                </div>

            </div>
            <!-- /top tiles -->

            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="dashboard_graph">

                        <div class="row x_title">
                            <div class="col-md-6">
                                <h3>Disaster Map <span> <a href="map.html" class="btn btn-xs btn-info"
                                                           style="float-right;">Full Map </a></span></h3>
                            </div>
                            <div class="col-md-6">
                                <div id="reportrange" class="pull-right"
                                     style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                    <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div id="placeholder33" style="height: 260px; display: none" class="demo-placeholder"></div>
                            <div style="width: 100%;">

                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3 col-xs-12 bg-white">
                            <div class="x_title">
                                <h2>Affected peoples by Province</h2>
                                <div class="clearfix"></div>
                            </div>

                            <div class="col-md-12 col-sm-12 col-xs-6">
                                <div>
                                    <p>Western Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="80"></div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <p>Sabaragamuwa Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="60"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12 col-xs-6">
                                <div>
                                    <p>Uva Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="40"></div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <p>Central Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="50"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="clearfix"></div>
                    </div>
                </div>

            </div>
            <br/>

            <div class="row">


                <div class="col-md-4 col-sm-4 col-xs-12">
                    <div class="x_panel tile fixed_height_320" style="background:#26b99a;color:#ffffff;">
                        <div class="x_title">
                            <h2>Weather Situation</h2>
                            <ul class="nav navbar-right panel_toolbox">


                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>

                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">

                            <span class="card-title" id="location"> <h4>Weather now in</h4></span>

                            </span>
                            <div class="card-content">
                                <div id="tempPreview">
                                    <span id="tempIcon"></span>
                                    <span id="temperature"></span>
                                </div>
                                <div id="weatherConditions">
                                    <i>Weather conditions:</i>
                                    <br>
                  <span id="weatherDetails">
                    </span>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>

                <div class="col-md-4 col-sm-4 col-xs-12">
                    <div class="x_panel tile fixed_height_320 overflow_hidden">
                        <div class="x_title">
                            <h2>Disaster Situation</h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>

                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <table class="" style="width:100%">
                                <tr>
                                    <th style="width:37%;">
                                        <p>Disasters</p>
                                    </th>
                                    <th>
                                        <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                            <p class="">Type</p>
                                        </div>
                                        <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                                            <p class="">Count</p>
                                        </div>
                                    </th>
                                </tr>
                                <tr>
                                    <td>
                                        <nvd3 options='options_district_doughnut' data='district_doughnut' api="api_disaster_icount" config="{refreshDataOnly: true, deepWatchData: true}"></nvd3>

                                    </td>
                                    <td>
                                        <table class="tile_info">
                                            <tr>
                                                <td>
                                                    <p><i class="fa fa-square blue"></i>Flood </p>
                                                </td>
                                                <td>20</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><i class="fa fa-square green"></i>Landslide </p>
                                                </td>
                                                <td>10</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><i class="fa fa-square purple"></i>Fire </p>
                                                </td>
                                                <td>20</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><i class="fa fa-square aero"></i>Storm </p>
                                                </td>
                                                <td>15</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><i class="fa fa-square red"></i>Others </p>
                                                </td>
                                                <td>30</td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>


                <div class="col-md-4 col-sm-4 col-xs-12">
                    <div class="x_panel tile fixed_height_320">
                        <div class="x_title">
                            <h2>Quick Settings</h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>

                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="col-md-12 col-sm-12 col-xs-6">
                                <div>
                                    <p>Western Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="80"></div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <p>Sabaragamuwa Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="60"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12 col-xs-6">
                                <div>
                                    <p>Uva Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="40"></div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <p>Central Province</p>
                                    <div class="">
                                        <div class="progress progress_sm" style="width: 76%;">
                                            <div class="progress-bar bg-green" role="progressbar"
                                                 data-transitiongoal="50"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
            <div class="pull-right">
                CFR Developed by <a href="https://geoedge.lk">GeoEDGE</a>
            </div>
            <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
    </div>
</div>

<!-- jQuery -->

<!-- Bootstrap -->
<script src="{% static 'dashboard/vendors/bootstrap/dist/js/bootstrap.min.js' %}"></script>
<!-- FastClick -->
<script src="{% static 'dashboard/vendors/fastclick/lib/fastclick.js' %}"></script>
<!-- NProgress -->
<script src="{% static 'dashboard/vendors/nprogress/nprogress.js' %}"></script>
<!-- Chart.js -->
<script src="{% static 'dashboard/vendors/Chart.js/dist/Chart.min.js' %}"></script>
<!-- gauge.js -->
<script src="{% static 'dashboard/vendors/gauge.js/dist/gauge.min.js' %}"></script>
<!-- bootstrap-progressbar -->
<script src="{% static 'dashboard/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js' %}"></script>


<script src="{% static 'dashboard/vendors/Chart.js/dist/Chart.min.js' %}"></script>

<!-- bootstrap-daterangepicker -->
<script src="{% static 'dashboard/js/moment/moment.min.js' %}"></script>
<script src="{% static 'dashboard/js/datepicker/daterangepicker.js' %}"></script>

<!-- Custom Theme Scripts -->
<script src="{% static 'dashboard/js/custom.js' %}"></script>

<script>
$(document).ready(function(){
  var absoluteTemp = 0;
  var key = "7c80d2d39bda8ec9e2dc987ace372a9c";
 var coords = {latitude : 0, longitude : 0};
  var isFahr = false;

  $("#changeUnit").on("click", function(){

    if(!isFahr){
      relTemp = Math.round((absoluteTemp*1.8)+32);
        isFahr = true;
        $("#temperature").contents().remove();
$("#temperature").append(relTemp + " F");
$(".card-action span").text("Change to Celsius");
    }
    else
      {
        relTemp = absoluteTemp;
        isFahr = false; $("#temperature").contents().remove();
$("#temperature").append(relTemp + " C");
        $(".card-action span").text("Change to Fahrenheit");
      }
  });


   $.get("http://ip-api.com/json", function(userLoc){
    coords.latitude = parseFloat(userLoc.lat).toFixed(2);
     coords.longitude = parseFloat(userLoc.lon).toFixed(2);
     console.log(coords);
     console.log('http://api.openweathermap.org/data/2.5/weather?lat='+coords.latitude+'&lon='+coords.longitude+ '&units=metric&APPID='+key);
     getWeatherData(coords.latitude, coords.longitude);
   }, "jsonp");
      //console.log(lat,long);



function getWeatherData(lat, long) {
 $.get('http://api.openweathermap.org/data/2.5/weather?lat='+lat+'&lon='+long+'&units=metric&APPID='+key,function(json) {
     $('#location').append(" " +json.name+", " + json.sys.country);
      $('#tempIcon').append("<img src='http://openweathermap.org/img/w/" + json.weather[0].icon + ".png'>");
   $('#temperature').append(json.main.temp+' C');
   absoluteTemp = json.main.temp;
   $('#weatherDetails').append(json.weather[0].main+", Humidity: "+json.main.humidity+'%');
$('#weatherDetails').append("<br>Cloud cover: " + json.clouds.all + "%");
  var direction = getWindDirection(json.wind.deg);
$("#weatherDetails").append("<br>Wind speed: " + parseFloat(json.wind.speed * 3.6).toFixed(2)+ " kph, Direction: " + direction);
   $("#pressure").append(json.main.pressure+" hPa");
   $("#sunrise").append((new Date(json.sys.sunrise*1000)).toLocaleTimeString());
   $("#sunset").append((new Date(json.sys.sunset*1000)).toLocaleTimeString());
   setBackgroundImage(absoluteTemp);

    console.log(json);
    }, "jsonp");

};



  function getWindDirection(degrees) {
    var quantDir = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];

    var roundDegree = Math.floor(degrees/45);

    return quantDir[roundDegree];
  };
});

</script>

<!-- bootstrap-daterangepicker -->
<script>
      $(document).ready(function() {

        var cb = function(start, end, label) {
          console.log(start.toISOString(), end.toISOString(), label);
          $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
        };

        var optionSet1 = {
          startDate: moment().subtract(29, 'days'),
          endDate: moment(),
          minDate: '01/01/2012',
          maxDate: '12/31/2015',
          dateLimit: {
            days: 60
          },
          showDropdowns: true,
          showWeekNumbers: true,
          timePicker: false,
          timePickerIncrement: 1,
          timePicker12Hour: true,
          ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          },
          opens: 'left',
          buttonClasses: ['btn btn-default'],
          applyClass: 'btn-small btn-primary',
          cancelClass: 'btn-small',
          format: 'MM/DD/YYYY',
          separator: ' to ',
          locale: {
            applyLabel: 'Submit',
            cancelLabel: 'Clear',
            fromLabel: 'From',
            toLabel: 'To',
            customRangeLabel: 'Custom',
            daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
            monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
            firstDay: 1
          }
        };
        $('#reportrange span').html(moment().subtract(29, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));
        $('#reportrange').daterangepicker(optionSet1, cb);
        $('#reportrange').on('show.daterangepicker', function() {
          console.log("show event fired");
        });
        $('#reportrange').on('hide.daterangepicker', function() {
          console.log("hide event fired");
        });
        $('#reportrange').on('apply.daterangepicker', function(ev, picker) {
          console.log("apply event fired, start/end dates are " + picker.startDate.format('MMMM D, YYYY') + " to " + picker.endDate.format('MMMM D, YYYY'));
        });
        $('#reportrange').on('cancel.daterangepicker', function(ev, picker) {
          console.log("cancel event fired");
        });
        $('#options1').click(function() {
          $('#reportrange').data('daterangepicker').setOptions(optionSet1, cb);
        });
        $('#options2').click(function() {
          $('#reportrange').data('daterangepicker').setOptions(optionSet2, cb);
        });
        $('#destroy').click(function() {
          $('#reportrange').data('daterangepicker').remove();
        });
      });

</script>
<!-- /bootstrap-daterangepicker -->


</body>
</html>
